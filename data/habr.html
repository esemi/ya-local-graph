<img src="https://habrastorage.org/web/413/ebc/8cd/413ebc8cd62745ae89c51b1b38dc58c9.png" alt="КДПВ"/>

Я очень давно пользуюсь яндекс музыкой для поиска "что послушать". Чаще всего, я просто хожу по похожим исполнителям приятных мне групп, однако, этот метод уже давно не даёт результатов.  Какое-то время мои потребности закрывало я.радио с фильтром по жанру, но и его репертуар на удивление скуп. Настало время решать проблему глобально, и вот что из этого получилось =)
<cut />
<h3>Что хотелось</h3>
Сразу замечу, что я не ставил целью узнать, как и хорошо ли работают рекомендации, или провести кластерный анализ. Над полученными данными можно поработать в очень разные стороны, но для моей конечной цели это не нужно.

А хотелось, в первую очередь, найти тех рок и метал исполнителей, о которых все знают, а я, ввиду своей неопытности, нет. 

Проблема ерундовая, скажете вы, возьми ТОП100 по версии какого-либо издания и радуйся, но оно так не работает: все топы, что я видел, либо слишком “новомодные” и мне не по нраву, либо очень классические и я всё это уже слышал.

Вообще, мои путешествия по музыке - это отдельная история: смешно было лицезреть  друзей-металлистов, когда я рассказывал им про новых для себя <a href="https://music.yandex.ru/artist/3276">Black Sabbath</a> в контексте "<i>вы только послушайте как звучат!</i>" =)

В общем, решено было собрать всех рок и метал исполнителей, и ссылки на других исполнителей с их страниц, посчитать входящие степени и построить свой топ. Ну, и раз уж у меня есть явно сетевая структура, не визуализировать её в виде графа было выше моих сил.


<h3>Как собирал</h3>
Не раз и не два садился я за этот проект, но каждый раз интерес затухал раньше значимого результата (прямо по книжке). В этот раз я решил послушаться идеологов хакатонов и постарался напилить минимальный рабочий продукт за минимальное же время. По этой причине остановился на сборе наиболее близких мне жанрах рока и метала вместо сбора всей музыки.

Сам парсинг написан на питоне и селениуме плюс Postgree для данных, поскольку под рукой был готовый проект на этом стеке. Селениум для продакшена решение конечно спорное, но у нас и не продакшен. 

Для начала я собрал данные по рок исполнителям, их оказалось около шести тысяч.
Когда стал собирать ссылки на похожих, оказалось, что рокеров на самом деле сильно больше и только небольшая их часть представлена в индексе по жанру. Отдельно собирал поджанры (русский рок и другие) - они с основным индексом совсем слабо пересекаются.  С металом сюрпризов уже не было, разве что на середине парсинга у него появились поджанры и пришлось собирать всё заново.

В общем, трижды всё пересобрав я понял, что всё, что мог сделал и нужно рисовать.
Хотелось бы отдельно попросить не ругаться ребят из яндекса на мои паразитные запросы, пусть их было не так много - парни, всё ради науки =)


<h3>Как рисовал</h3>
Хотел я наконец отказаться от ручного рисования в пользу <a href="https://gephi.org/">Gephi</a>, чтоб только ползуночки двигать между <i>красиво</i> и <i>понятно</i>, но не срослось - небольшие графы на тысячу вершин он отлично рисует, а в десять раз больше молча отказывается. Ни ошибок, ни приветов, у коллег на винде работает, а у меня белый лист =( Сделал себе зарубку к нему вернуться (и вам рекомендую), и пошёл рисовать привычными средствами. 

Поднял довольно <a href="http://blog.esemi.ru/search/label/graph">старенькое сравнение</a> питонячих либ для распасовки графов и выбрал <a href="http://igraph.org/python/">Igraph</a> с FR алгоритмом за итоговую картинку и удовлетворительную производительность. 


<h3>Что получилось</h3>
Немного вводных, которые могут показаться неочевидными:

<ul>
	<li>вершина - исполнитель;</li>
	<li>рёбра - ссылки на похожих;</li>
	<li>граф направленный, но стрелки увидеть можно не всегда;</li>
	<li>вес вершины - величина входящей степени (ссылки на исполнителя как похожего у других исполнителей);</li>
	<li>в легенде у большинства графов записаны размер в формате <i>вершины х рёбра</i>, коэффициент кластеризации и средняя близость вершин.</li>
</ul>
Все графы построены без учёта одиночек - тех артистов, на которых никто не ссылается и которые сами ни на кого не ссылаются. Они только создают шум и не дают никакой дополнительной информации. Можно было отсечь и вершины с небольшими степенями дабы не засоряли изображение, но мне показалось, я смог без этого обойтись на итоговом графе.
Некоторые графы представлены в двух вариантах - основном и полном. Отличаются они тем, что в первом варианте участвуют только исполнители, входящие в индекс я.музыки по какому либо жанру (условно primary исполнители). 

<h4>Метал</h4>
Начнём с поджанров. Графы небольшие, поэтому строил сразу полные.

<a href="https://habrastorage.org/web/015/7ce/90a/0157ce90ae8d488c8c3aa781e5d5978a.png" title="фолк метал"><img src="https://habrastorage.org/web/410/c1a/90c/410c1a90c12340baaceed5f53f5aeff7.png" alt="фолк метал"/></a><a href="https://habrastorage.org/web/257/2c1/f66/2572c1f66b5f4cc59abb3dfd104ffc76.png" title="прогрессив метал"><img src="https://habrastorage.org/web/8b9/365/2f4/8b93652f4c054b8a96704d39accf026e.png" alt="прогрессив метал"/></a>

<a href="https://habrastorage.org/web/7f6/c09/797/7f6c09797b314b8a8e989199adedef37.png" title="ню метал"><img src="https://habrastorage.org/web/1db/dea/120/1dbdea1201854cfb9d85f0084c241ce6.png" alt="ню метал"/></a><a href="https://habrastorage.org/web/c07/983/224/c0798322400342bf9e2cbbde28aee368.png" title="эпик метал"><img src="https://habrastorage.org/web/375/587/045/3755870455dc4802a96b3648784089d3.png" alt="эпик метал"/></a>

<a href="https://habrastorage.org/web/85d/413/f1e/85d413f1ebd343afb655fd96e2518c7a.png" title="экстрим метал"><img src="https://habrastorage.org/web/47e/87b/f5f/47e87bf5ffd944709c123c569831efc2.png" alt="экстрим метал"/></a><a href="https://habrastorage.org/web/870/2ac/6cc/8702ac6ccea5456ba5f387047bf40cfd.png" title="классика метал"><img src="https://habrastorage.org/web/42c/722/9a1/42c7229a19ef4995b96a320bb9738a98.png" alt="классика метал"/></a>

Поджанры метала на момент сбора только появились, думаю сейчас они значительно выросли.
А вот так выглядит суммарный граф метала со всеми поджанрами в двух вариантах - основной и полный.

<a href="https://habrastorage.org/web/212/756/64c/21275664cf3a48a08f0e39877e28fa89.png" title="основные исполнители метала"><img src="https://habrastorage.org/web/ab6/63a/2cc/ab663a2cc10347f4b76220f2e9641475.png" alt="основные исполнители метала"/></a><a href="https://habrastorage.org/web/eb6/40d/8ea/eb640d8eab1342fab156f0b226a14020.png" title="все исполнители метала"><img src="https://habrastorage.org/web/f96/f19/cb1/f96f19cb1e8946c58356eb59e5c682bf.png" alt="все исполнители метала"/></a>

<h4>Рок</h4>

<a href="https://habrastorage.org/web/b7c/ab7/cd2/b7cab7cd2b464349a7da65f8620243d7.png" title="украинский рок"><img src="https://habrastorage.org/web/368/615/27b/36861527b34b4dfca79b4809fc526a07.png" alt="украинский рок"/></a><a href="https://habrastorage.org/web/6b8/bdf/466/6b8bdf4661204955bd7a66ce3fe12c5a.png" title="new wave"><img src="https://habrastorage.org/web/11e/9fe/157/11e9fe15727c4e11a12ce54176203320.png" alt="new wave"/></a>

<a href="https://habrastorage.org/web/c9b/15e/19b/c9b15e19b03d4f11a46e0cadfe79eaf7.png" title="пост-рок"><img src="https://habrastorage.org/web/b35/442/4c7/b354424c7f104c3f9a9383f327abaa3c.png" alt="пост-рок"/></a><a href="https://habrastorage.org/web/24e/7b2/7cd/24e7b27cdd7f49c0bd4a8cd9168e1575.png" title="русский рок"><img src="https://habrastorage.org/web/a00/1ad/27d/a001ad27d2114dc38c0507fb0b2885ed.png" alt="русский рок"/></a>

<a href="https://habrastorage.org/web/46a/5e2/805/46a5e2805ea84b13a4e6433176732f24.png" title="рок-н-ролл"><img src="https://habrastorage.org/web/6f9/9c6/570/6f99c65702a2488a8c1890a02f97b0e2.png" alt="рок-н-ролл"/></a><a href="https://habrastorage.org/web/de3/2ac/945/de32ac9456934a41ab0cfb3db31bd049.png" title="прогрессивный рок"><img src="https://habrastorage.org/web/ce1/ab2/bc3/ce1ab2bc3c8440e4912422c94724d963.png" alt="прогрессивный рок"/></a>

Заметьте насколько прогрессив и рок-н-ролл опережают своих собратьев. Рок исполнителей вообще сильно больше металистов (25 тысяч против 8,5), возможно это особенности я.музыки или относительная молодость метала.

Суммарный граф рока со всеми поджанрами, тоже в двух вариантах.

<a href="https://habrastorage.org/web/2c4/7dd/81d/2c47dd81d64c47a6859710b1bc1cbca5.png" title="основные исполнители рока"><img src="https://habrastorage.org/web/420/8bb/d11/4208bbd1112e4b81aa53d2bc5986a5de.png" alt="основные исполнители рока"/></a><a href="https://habrastorage.org/web/7a8/b6c/999/7a8b6c999d8140b9912ca209220550bd.png" title="все исполнители рока"><img src="https://habrastorage.org/web/5a2/dc4/5e4/5a2dc45e43e746bd87bd90729ac0c2e4.png" alt="все исполнители рока"/></a>

На основном графе отлично виден маленький и гордый кластер русского рока, столь далёкий от остальных.

<h4>Пересечение рок + метал</h4>
Наконец, начнём пересекать оба жанра. Тут уже только полные графы.

<a href="https://photos.app.goo.gl/PWVbeEpHOvWtywEx2" title="пересечение рока и метала"><img src="https://habrastorage.org/web/10b/664/843/10b664843d5b479580170938aeaa2a14.png" alt="пересечение рока и метала"/></a>
Красным отмечены рок исполнители, синим - метал, фиолетовым - оба жанра одновременно (это когда исполнитель одновременно и рок и метал). В таком виде удобно смотреть насколько близки эти жанры в принципе. Издалека это выглядит конечно интересно, но мне хотелось большей наглядности.

Изменив размер каждой вершины пропорционально её входящей степени я получил наконец ту картинку, которую буду долго изучать в поисках интересного.
<a href="https://drive.google.com/open?id=0B9eXus9GJme9dHBpb1U2bS1VM0U" title="пересечение рока и метала"><img src="https://habrastorage.org/web/89d/8a3/808/89d8a38086484d619dfba7f3f060367d.png" alt="пересечение рока и метала"/></a>

На этой превьюшке ничего не разглядеть, но она кликабельна и за ней карта в <b>10х10 килопикселей</b> с легендой для вершин весом 30 и более. Эта же карта есть в другом разрешении (<a href="https://drive.google.com/open?id=0B9eXus9GJme9dHBpb1U2bS1VM0U">10к</a>, <a href="https://drive.google.com/open?id=0B9eXus9GJme9Q2ZRYzdIVXNiaU0">20к</a>, <a href="https://drive.google.com/open?id=0B9eXus9GJme9ejI2QVg3VDhjMU0">32к</a>). В конце статьи есть ссылки на <a href="https://drive.google.com/drive/folders/0B9eXus9GJme9aUtVSktIWENRTm8?usp=sharing">более детальные варианты</a> этой карты и на исходники (на случай если вам захочется свой вариант цвета/размера/etc). 


<h3>Интересное</h3>
Сердце рока - Элвис непобедим!

<img src="https://habrastorage.org/web/9c4/62c/3b4/9c462c3b46a04b45aac735a1b36fdc87.png" alt="сердце рока"/>

<br />
<img src="https://habrastorage.org/web/494/b1b/04f/494b1b04fefe4a68a4ce88a920f702c6.png" alt="рок и метал - переход" align="left"/>Перешеек между роком и металом. Фиолетовые, напомню, исполнители которые входят в оба жанра.
<br clear="left"/>

<br />
Сердце метала. В отличии от рока тут фиолетовые есть и имеют приличный вес.

<img src="https://habrastorage.org/web/8a0/123/3d5/8a01233d5e984db481d0e7b43a77cb04.png" alt="сердце метала"/>

<br />
<img src="https://habrastorage.org/web/7e1/4d2/726/7e14d2726541417aa9ddea30b73325ab.png" alt="русский рок"align="left"/>Русский рок стоит очень особняком и почти не связан с металом, даже русским.<br clear="left"/>

<br />
<img src="https://habrastorage.org/web/c71/849/42e/c7184942ef654f0d83931427363546ba.png" alt="интересный кластер рока"align="left"/>Забавный кластер рокеров - немногочисленный, очень плотный и увесистый.<br clear="left"/>

<br />
Кусочек русского метала очень далеко от всех.

<img src="https://habrastorage.org/web/083/cf3/bab/083cf3bab0f245d3bd7488109719b8ad.png" alt="русский метал" />


<h4>Топы</h4>
Интересно было посмотреть топов по входящей степени
<table><tr><td><table>
<caption><b>Рок</b></caption>
<tr><td><i>Исполнитель</i></td><td><i>Степень</i></td></tr>
<tr><td>Elvis Presley</td><td>185</td></tr>
<tr><td>Deep Purple</td><td>133</td></tr>
<tr><td>Paul McCartney</td><td>97</td></tr>
<tr><td>Eric Clapton</td><td>93</td></tr>
<tr><td>Whitesnake</td><td>73</td></tr>
<tr><td>ЧайФ</td><td>73</td></tr>
<tr><td>David Bowie</td><td>72</td></tr>
<tr><td>The Rolling Stones</td><td>70</td></tr>
<tr><td>The Ventures</td><td>67</td></tr>
<tr><td>Би-2</td><td>67</td></tr>
</table></td><td><table>
<caption><b>Метал</b></caption>
<tr><td><i>Исполнитель</i></td><td><i>Степень</i></td></tr>
<tr><td>Black Sabbath</td><td>78</td></tr>
<tr><td>Edguy</td><td>62</td></tr>
<tr><td>Sonata Arctica</td><td>60</td></tr>
<tr><td>In Flames</td><td>58</td></tr>
<tr><td>Therion</td><td>58</td></tr>
<tr><td>Judas Priest</td><td>57</td></tr>
<tr><td>Glenn Hughes</td><td>56</td></tr>
<tr><td>Eluveitie</td><td>55</td></tr>
<tr><td>Of Mice & Men</td><td>54</td></tr>
<tr><td>Doro Pesch</td><td>54</td></tr>
</table></td></tr>
</table>Интересно, что исполнители ссылаются не только на своих коллег по стилю. Топ по входящим ссылкам вне жанров рока и метала.<table>
<caption><b>Другие жанры</b></caption>
<tr><td><i>Исполнитель</i></td><td><i>Степень</i></td></tr>
<tr><td>Dr</td><td>114</td></tr>
<tr><td>Bob Dylan</td><td>87</td></tr>
<tr><td>Ryan Tedder</td><td>61</td></tr>
<tr><td>Pharrell</td><td>58</td></tr>
<tr><td>John Frusciante</td><td>48</td></tr>
<tr><td>Rihanna</td><td>47</td></tr>
<tr><td>Frank Sinatra</td><td>47</td></tr>
<tr><td>Lana Del Rey</td><td>46</td></tr>
<tr><td>Ray Charles</td><td>44</td></tr>
<tr><td>NOFX</td><td>43</td></tr>
</table>Обратите внимание на самого первого исполнителя <a href="https://music.yandex.ru/artist/271402/tracks">Dr</a>. Его страничка весьма скудна, при этом вес и сейчас не маленький (шутка ли, почти deep purple и это среди рокеров/металлистов), а до весеннего апдейта был и вовсе огромным. Может его добавляли как похожего когда никого более подходящего не нашлось, а ссылок нужно было добрать до девяти? Это могут сказать только ребята из яндекса.


<h3>Заключение</h3>
Надеюсь, вы почерпнули для себя что-нибудь интересное из статьи. Лично я составил себе большой список исполнителей на ознакомление и надеюсь найти новых любимчиков.
Попрошу также не забывать, что всё представленное есть результат работы рекомендаций я.музыки, так что граф может быть очень далек от аналогов с зарубежных агрегаторов. 
Буду рад аргументированной критике и фидбеку по проделанной работе.

→ <a href="https://github.com/esemi/ya-local-graph">Исходники</a> 
→ <a href="https://drive.google.com/drive/folders/0B9eXus9GJme9aUtVSktIWENRTm8?usp=sharing">Варианты итогового графа</a>


<h3>Послесловие</h3>
<ol>
	<li>Будьте аккуратны с запуском скриптов на локальной машине. За парсинг яндекса вас могут на нём забанить, а рендер картинок может съесть всю память, особенно если её меньше 16гб.</li>
	<li>Аналогично рассчитывайте производительность своего ноутбука, прежде чем открывать карту в 32 килопикселя.</li>
	<li>Cairo, которая под капотом рисовальщика Igraph-а, падает в кору на генерации больших картинок в <b>не</b> последних версиях, а в последней загоняет нас в рамки 32к пикселей. Если вам нужно больше <s>золота</s> - генерируйте .ps файл и конвертируйте его сторонними средствами.</li>
	<li>Насколько я заметил, вопрос количества <b>л</b><i></i> в названии жанра метала является очень болезненным, поэтому я придерживаюсь стороны я.музыки, раз уж все данные с неё. Очень прошу не разжигать на эту тему =)</li>
</ol>